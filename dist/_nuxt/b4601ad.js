(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{207:function(t,e,o){"use strict";o.d(e,"a",(function(){return c}));var n=o(84),r=o(0),c=Object(r.i)("v-toolbar__title"),l=Object(r.i)("v-toolbar__items");n.a},744:function(t,e,o){"use strict";o(9),o(8),o(83),o(27),o(285),o(284);var n=o(286),r=o(38);e.a=Object(n.a)("container").extend({name:"v-container",functional:!0,props:{id:String,tag:{type:String,default:"div"},fluid:{type:Boolean,default:!1}},render:function(t,e){var o,n=e.props,data=e.data,c=e.children,l=data.attrs;return l&&(data.attrs={},o=Object.keys(l).filter((function(t){if("slot"===t)return!1;var e=l[t];return t.startsWith("data-")?(data.attrs[t]=e,!1):e||"string"==typeof e}))),n.id&&(data.domProps=data.domProps||{},data.domProps.id=n.id),t(n.tag,Object(r.a)(data,{staticClass:"container",class:Array({"container--fluid":n.fluid}).concat(o||[])}),c)}})},869:function(t,e,o){"use strict";o.r(e);var n=o(19),r=(o(59),o(32),o(7),o(8),{mounted:function(){this.idAuth=JSON.parse(sessionStorage.getItem("usuario"))?"id"+JSON.parse(sessionStorage.getItem("usuario")).id:"",this.ObtenerChats(),this.ObtenerNegocios(),this.ObtenerUsuarios()},middleware:"VerificarUsuarioAuth",head:function(){return{titleTemplate:"Antigua Travel | Bandeja de Entrada"}},data:function(){return{clipped:!1,drawer:!1,fixed:!1,chat_pool:[],chats:{},seleccionado:0,userChats:[],negocios:{},usuarios:{},idAuth:-1,mensajesRef:null,mensajes:[]}},layout:"chat",methods:{CambiarChat:function(){this.$store.commit("setUsuarioChatActual",this.chat_pool[this.seleccionado]),this.mensajesRef=this.$fire.database.ref("chatMessages").child(this.$store.state.usuarioChatActual.chat),this.ObtenerMensajes()},ObtenerNombreChat:function(t){return this.chat_pool[this.seleccionado].negocio===t?this.negocios[t][this.chat_pool[this.seleccionado].key_negocio].nombreNegocio:this.usuarios[t].nombre},ObtenerImagenChat:function(t){if(this.chat_pool[this.seleccionado].negocio===t){var e=this.negocios[t][this.chat_pool[this.seleccionado].key_negocio].image;return""!==e?e:"https://www.timandorra.com/wp-content/uploads/2016/11/Imagen-no-disponible-282x300.png"}var o=this.usuarios[t].image;return""!==o?o:"https://www.timandorra.com/wp-content/uploads/2016/11/Imagen-no-disponible-282x300.png"},ObtenerChats:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.$fire.database.ref("Chats"),e.next=3,o.on("value",(function(e){t.chats=e.val(),t.ObtenerChatsUsuario()}),(function(t){console.log("La lectura en la DB fallo: "+t.name)}));case 3:case"end":return e.stop()}}),e)})))()},ObtenerMensajes:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.mensajesRef.on("value",(function(e){t.mensajes=[],e.exists()&&(Object.keys(e.val()).forEach((function(o){t.mensajes.push(e.val()[o])})),t.$vuetify.goTo(document.body.scrollHeight))}),(function(t){console.log("La lectura en la DB fallo: "+t.name)}));case 2:case"end":return e.stop()}}),e)})))()},ObtenerNegocios:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.$fire.database.ref("Negocios"),e.next=3,o.on("value",(function(e){t.negocios=e.val()}),(function(t){console.log("La lectura en la DB fallo: "+t.name)}));case 3:case"end":return e.stop()}}),e)})))()},ObtenerUsuarios:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.$fire.database.ref("Users"),e.next=3,o.on("value",(function(e){t.usuarios=e.val()}),(function(t){console.log("La lectura en la DB fallo: "+t.name)}));case 3:case"end":return e.stop()}}),e)})))()},ObtenerChatsUsuario:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.$fire.database.ref("userChats/"+t.idAuth),e.next=3,o.on("value",(function(e){t.userChats=[],t.chat_pool=[],t.userChats=e.val()?Object.keys(e.val()):[];var o=t.chats?Object.keys(t.chats):[];t.userChats.forEach((function(e){var n={};o.forEach((function(o){o===e&&(n=Object.assign({},t.chats[o]),Object.keys(n).forEach((function(o){n[o].usuario===t.idAuth&&(n[o].idChat=o,n[o].chat=e,t.chat_pool.push(n[o]))})))}))})),t.chat_pool.length>0?(t.$route.query.id&&t.$route.query.id>0?t.chat_pool.forEach((function(e){e.key_negocio==="idNegocio"+t.$route.query.id&&(t.seleccionado=t.chat_pool.indexOf(e),t.mensajesRef=t.$fire.database.ref("chatMessages").child(t.chat_pool[t.chat_pool.indexOf(e)].chat),t.$store.commit("setUsuarioChatActual",t.chat_pool[t.chat_pool.indexOf(e)]))})):(t.mensajesRef=t.$fire.database.ref("chatMessages").child(t.chat_pool[0].chat),t.$store.commit("setUsuarioChatActual",t.chat_pool[0])),t.$store.commit("setHideMessageField",!1),t.ObtenerMensajes()):t.$store.commit("setHideMessageField",!0)}),(function(t){console.log("La lectura en la DB fallo: "+t.name)}));case 3:case"end":return e.stop()}}),e)})))()}}}),c=o(24),l=o(50),v=o.n(l),d=o(743),h=o(726),m=o(264),f=o(158),_=o(267),y=o(52),x=o(727),w=o(744),C=o(260),j=o(198),O=o(204),k=o(729),$=o(261),V=o(159),A=o(263),P=o(23),I=o(265),R=o(731),M=o(732),N=o(733),L=o(207),S=o(734),component=Object(c.a)(r,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-container",{attrs:{fluid:"","fill-height":0===t.chat_pool.length}},[t.chat_pool&&t.chat_pool.length>0?o("v-navigation-drawer",{attrs:{clipped:t.clipped,fixed:"",app:"",width:"sm"===t.$vuetify.breakpoint.name||"xs"===t.$vuetify.breakpoint.name?350:500,color:"primary"},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[o("v-layout",{attrs:{"justify-center":""}},[o("v-img",{attrs:{src:"/logo-no-texto.png",contain:"",width:"250",height:"250"}})],1),t._v(" "),o("v-list",[o("v-list-item",[o("v-btn",{attrs:{color:"tertiary",dark:""},on:{click:function(e){t.$router.push({path:t.$nuxt.context.from.path?t.$nuxt.context.from.path:"/"})}}},[o("v-icon",{attrs:{left:""}},[t._v("\n            fa fa-arrow-left\n          ")]),t._v("\n          Regresar\n        ")],1)],1),t._v(" "),o("v-divider"),t._v(" "),o("v-list-item-group",{attrs:{mandatory:"",color:"secondary"},on:{change:t.CambiarChat},model:{value:t.seleccionado,callback:function(e){t.seleccionado=e},expression:"seleccionado"}},t._l(t.chat_pool,(function(e,n){return o("v-list-item",{key:n,staticClass:"ma-2",attrs:{exact:"",link:"",outlined:""}},[o("v-list-item-avatar",[o("v-img",{attrs:{src:t.negocios&&""!==t.negocios[e.negocio][e.key_negocio].image?t.negocios[e.negocio][e.key_negocio].image:"https://www.timandorra.com/wp-content/uploads/2016/11/Imagen-no-disponible-282x300.png"}})],1),t._v(" "),o("v-list-item-content",[o("v-list-item-title",[o("h4",[t._v("\n                "+t._s(t.negocios?t.negocios[e.negocio][e.key_negocio].nombreNegocio:"")+"\n              ")]),t._v(" "),o("v-spacer"),t._v(" "),o("span",[t._v("\n                "+t._s(e.fechaHora?t.$moment(e.fechaHora,"L h:mm:ss a").fromNow():null)+"\n              ")])],1),t._v(" "),o("v-list-item-subtitle",[e.ultimoEnviadoPor===t.idAuth?o("div",[o("v-icon",{attrs:{small:""}},[t._v("fa fa-check")]),t._v("\n                "+t._s(""!==e.ultimoMensaje?e.ultimoMensaje:"Aún no hay mensajes en esta conversación")+"\n              ")],1):o("div",["formReservacion"!==e.ultimoMensaje?o("div",[t._v("\n                  "+t._s(""!==e.ultimoMensaje?e.ultimoMensaje:"Aún no hay mensajes en esta conversación")+"\n                ")]):o("div",[t._v("\n                  Te enviaron un link de reservación\n                ")])])])],1)],1)})),1)],1)],1):t._e(),t._v(" "),o("v-app-bar",{attrs:{fixed:"",app:"",flat:"",color:"primary",outlined:"",height:"80"}},[t.chat_pool&&t.chat_pool.length>0?o("v-app-bar-nav-icon",{attrs:{color:"secondary"},on:{click:function(e){e.stopPropagation(),t.drawer=!t.drawer}}}):t._e(),t._v(" "),t.drawer?t._e():o("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,r=e.attrs;return[o("v-btn",t._g(t._b({attrs:{color:"secondary",dark:"",icon:""},on:{click:function(e){t.$router.push({path:t.$nuxt.context.from.path?t.$nuxt.context.from.path:"/"})}}},"v-btn",r,!1),n),[o("v-icon",{attrs:{color:"secondary"}},[t._v(" fa fa-arrow-left ")])],1)]}}],null,!1,3121737462)},[t._v(" "),o("span",[t._v("Regresar")])]),t._v(" "),t.chat_pool&&t.chat_pool.length>0?o("v-avatar",{staticClass:"mr-2",attrs:{size:"45"}},[o("v-img",{staticClass:"mr-2",attrs:{src:t.negocios&&t.chat_pool[t.seleccionado]&&""!==t.negocios[t.chat_pool[t.seleccionado].negocio][t.chat_pool[t.seleccionado].key_negocio].image?t.negocios[t.chat_pool[t.seleccionado].negocio][t.chat_pool[t.seleccionado].key_negocio].image:"https://www.timandorra.com/wp-content/uploads/2016/11/Imagen-no-disponible-282x300.png","min-width":"100","min-height":"100",contain:""}})],1):o("v-avatar",{attrs:{size:"60"}},[o("v-img",{staticClass:"mr-2",attrs:{src:"/logo-no-texto.png",width:"100",height:"100",contain:""}})],1),t._v(" "),t.chat_pool&&t.chat_pool.length>0?o("v-toolbar-title",[t._v("\n      "+t._s(t.negocios&&t.chat_pool[t.seleccionado]?t.negocios[t.chat_pool[t.seleccionado].negocio][t.chat_pool[t.seleccionado].key_negocio].nombreNegocio:"")+"\n    ")]):o("v-toolbar-title",{domProps:{textContent:t._s("No hay mensajes para mostrar")}})],1),t._v(" "),o("v-list-item-group",t._l(t.mensajes,(function(e,i){return o("v-row",{key:i,attrs:{justify:e.enviadoPor!==t.idAuth?"end":"start"}},[o("v-col",{attrs:{cols:"12"}},[o("v-layout",{attrs:{"justify-center":""}},[o("div",{staticClass:"text-secondary"},[t._v("\n            "+t._s(t.$moment.utc(e.fecha,"DD/MM/YYYY").format("D [ de ] MMMM YYYY"))+" a las "+t._s(e.hora)+"\n          ")])])],1),t._v(" "),o("v-col",{attrs:{cols:"10",xl:"4",lg:"4",md:"6",sm:"8",xs:"8"}},[o("v-card",{staticClass:"mb-2",staticStyle:{"border-radius":"50px"},attrs:{elevation:"0",outlined:""}},["formReservacion"!==e.mensaje?o("v-list-item",{staticClass:"ma-2",attrs:{exact:"",link:"",inactive:""}},[e.enviadoPor===t.idAuth?o("v-list-item-avatar",{staticClass:"align-center"},[o("v-img",{attrs:{src:t.ObtenerImagenChat(e.enviadoPor)}})],1):t._e(),t._v(" "),o("v-list-item-content",{class:e.enviadoPor!==t.idAuth?"text-right align-self-start":null,attrs:{color:"white"}},[o("v-list-item-title",{domProps:{textContent:t._s(t.ObtenerNombreChat(e.enviadoPor))}}),t._v(" "),o("v-list-item-subtitle",{staticClass:"text-wrap",domProps:{textContent:t._s(e.mensaje)}})],1),t._v(" "),e.enviadoPor!==t.idAuth?o("v-list-item-avatar",{staticClass:"align-center"},[o("v-img",{attrs:{src:t.ObtenerImagenChat(e.enviadoPor)}})],1):t._e()],1):o("v-list-item",{staticClass:"ma-2",attrs:{exact:"",inactive:""}},[e.enviadoPor===t.idAuth?o("v-list-item-avatar",{staticClass:"align-center"},[o("v-img",{attrs:{src:t.ObtenerImagenChat(e.enviadoPor)}})],1):t._e(),t._v(" "),o("v-list-item-content",{class:e.enviadoPor!==t.idAuth?"text-right align-self-start":null,attrs:{color:"white"}},[o("v-list-item-title",{domProps:{textContent:t._s(t.ObtenerNombreChat(e.enviadoPor))}}),t._v(" "),o("v-list-item-subtitle",{staticClass:"text-wrap"},[o("v-card",{staticClass:"mt-2",staticStyle:{"border-radius":"15px"},attrs:{to:"/negocios/reservaciones?id="+t.negocios[t.chat_pool[t.seleccionado].negocio][t.chat_pool[t.seleccionado].key_negocio].negocioId,color:"grey lighten-4",elevation:"0",outlined:""}},[o("v-layout",{attrs:{"justify-center":""}},[o("v-card-title",{staticClass:"font-weight-bold"},[t._v("\n                      Formulario de Reservación\n                    ")])],1),t._v(" "),o("v-card-subtitle",{staticClass:"mt-n5 text-justify"},[t._v("\n                    En el siguiente link podrás solicitar una reservación con nosotros\n                  ")]),t._v(" "),o("v-card-text",[o("v-layout",{attrs:{"justify-center":""}},[o("v-img",{attrs:{src:"/logo-no-texto.png",contain:"","max-height":"200","max-width":"200"}})],1)],1)],1)],1)],1),t._v(" "),e.enviadoPor!==t.idAuth?o("v-list-item-avatar",{staticClass:"align-center"},[o("v-img",{attrs:{src:t.ObtenerImagenChat(e.enviadoPor)}})],1):t._e()],1)],1)],1)],1)})),1),t._v(" "),0===t.chat_pool.length?o("v-layout",{attrs:{"justify-center":"","align-center":"",row:"",wrap:""}},[o("v-row",{attrs:{align:"center",justify:"center"}},[o("v-col",{attrs:{cols:"12"}},[o("v-layout",{attrs:{"justify-center":""}},[o("v-icon",{attrs:{size:"150",color:"secondary"}},[t._v("\n\n            fa fa-exclamation-triangle\n\n          ")])],1)],1),t._v(" "),o("v-col",{attrs:{cols:"12"}},[o("v-layout",{attrs:{"justify-center":""}},[o("div",{staticClass:"subtitle justify-text",staticStyle:{"font-size":"18px"}},[t._v("\n            Aún no has iniciado ninguna conversación\n          ")])])],1)],1)],1):t._e()],1)}),[],!1,null,null,null);e.default=component.exports;v()(component,{VAppBar:d.a,VAppBarNavIcon:h.a,VAvatar:m.a,VBtn:f.a,VCard:_.a,VCardSubtitle:y.b,VCardText:y.c,VCardTitle:y.d,VCol:x.a,VContainer:w.a,VDivider:C.a,VIcon:j.a,VImg:O.a,VLayout:k.a,VList:$.a,VListItem:V.a,VListItemAvatar:A.a,VListItemContent:P.a,VListItemGroup:I.a,VListItemSubtitle:P.b,VListItemTitle:P.c,VNavigationDrawer:R.a,VRow:M.a,VSpacer:N.a,VToolbarTitle:L.a,VTooltip:S.a})}}]);